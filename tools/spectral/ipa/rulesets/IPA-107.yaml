# IPA-107: Update
# http://go/ipa/107

functions:
  - updateMethodMustNotHaveQueryParams
  - updateResponseCodeShouldBe200OK

rules:
  xgen-IPA-107-put-must-not-have-query-params:
    description: >-
      Update operations must not accept query parameters.

      ##### Implementation details

      Validation checks the PUT method for single resource paths and singleton resources.

        - Query parameters `envelope` and `pretty` are exempt from this rule
        - Operation objects with `x-xgen-IPA-exception` for this rule are excluded from validation
    message: '{{error}} http://go/ipa-spectral#IPA-107'
    severity: warn
    given: '$.paths[*].put'
    then:
      function: 'updateMethodMustNotHaveQueryParams'
      functionOptions:
        ignoredValues: ['pretty', 'envelope']
  xgen-IPA-107-patch-must-not-have-query-params:
    description: >-
      Update operations must not accept query parameters.

      ##### Implementation details

      Validation checks the PATCH method for single resource paths and singleton resources.

        - Query parameters `envelope` and `pretty` are exempt from this rule
        - Operation objects with `x-xgen-IPA-exception` for this rule are excluded from validation
    message: '{{error}} http://go/ipa-spectral#IPA-107'
    severity: warn
    given: '$.paths[*].patch'
    then:
      function: 'updateMethodMustNotHaveQueryParams'
      functionOptions:
        ignoredValues: ['pretty', 'envelope']
  xgen-IPA-107-put-method-response-code-is-200:
    description: >-
      The Update method response status code should be 200 OK.

      ##### Implementation details

      Validation checks the PUT method for single resource paths and singleton resources.

        - Operation objects with `x-xgen-IPA-exception` for this rule are excluded from validation
    message: '{{error}} http://go/ipa-spectral#IPA-107'
    severity: warn
    given: '$.paths[*].put'
    then:
      function: 'updateResponseCodeShouldBe200OK'
  xgen-IPA-107-patch-method-response-code-is-200:
    description: >-
      The Update method response status code should be 200 OK.

      ##### Implementation details

      Validation checks the PATCH method for single resource paths and singleton resources.

        - Operation objects with `x-xgen-IPA-exception` for this rule are excluded from validation
    message: '{{error}} http://go/ipa-spectral#IPA-107'
    severity: warn
    given: '$.paths[*].patch'
    then:
      function: 'updateResponseCodeShouldBe200OK'

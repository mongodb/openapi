# IPA-124: Repeated Fields
# http://go/ipa/124

functions:
  - IPA124ArrayMaxItems

rules:
  xgen-IPA-124-array-max-items:
    description: |
      Array fields must have a maxItems property defined with a value of 100.

      ##### Implementation details
      Rule checks for the following conditions:

        - All schema objects with type 'array' must have a maxItems property
        - The maxItems value must be set to 100
        - This validation threshold can be adjusted by changing the functionOptions.maxItems parameter
    message: '{{error}} https://mdb.link/mongodb-atlas-openapi-validation#xgen-IPA-124-array-max-items'
    severity: warn
    resolved: false
    given: $..[?(@ && @.type === "array")]
    then:
      function: IPA124ArrayMaxItems
      functionOptions:
        maxItems: 100

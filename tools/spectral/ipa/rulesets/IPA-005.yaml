# IPA-5: Documenting Exceptions to IPAs
# https://mongodb.github.io/ipa/5

functions:
  - IPA005ExceptionExtensionFormat

rules:
  xgen-IPA-005-exception-extension-format:
    description: |
      IPA exception extensions must follow the correct format.

      ##### Implementation details
      Rule checks for the following conditions:
        - Exception rule names must start with 'xgen-IPA-' prefix followed by exactly 3 digits
        - Exception rule names can be either short format (xgen-IPA-XXX) or full format (xgen-IPA-XXX-rule-name)
        - Rule names in full format can use letters (upper/lowercase), numbers, and hyphens
        - Each exception must include a non-empty reason as a string that starts with uppercase and ends with a full stop
        - This rule itself does not allow exceptions
    message: '{{error}} https://mdb.link/mongodb-atlas-openapi-validation#xgen-IPA-005-exception-extension-format'
    severity: error
    given: '$..x-xgen-IPA-exception'
    then:
      function: 'IPA005ExceptionExtensionFormat'

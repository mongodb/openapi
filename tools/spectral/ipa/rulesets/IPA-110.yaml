# IPA-110: Pagination
# http://go/ipa/110

functions:
  - IPA110CollectionsUsePaginatedSchema

rules:
  xgen-IPA-110-collections-use-paginated-schema:
    description: |
      APIs that return collections of resources must use a paginated response schema.

      ##### Implementation details
      Rule checks for the following conditions:
        - Only applies to List methods (GET operations that return collections of resources)
        - Checks that the 200 response schema references a schema with a name starting with either a name starting with "Paginated" or contain both "totalCount" (integer) and "results" (array) fields
        - If the referenced schema name has "Paginated" prefix, the rule assumes that the schema is paginated and does not check for "totalCount" and "results" fields
    message: '{{error}} https://mdb.link/mongodb-atlas-openapi-validation#xgen-IPA-110-list-methods-must-use-paginated-schema'
    severity: warn
    given: '$.paths[*].get.responses.200.content'
    then:
      field: '@key'
      function: 'IPA110CollectionsUsePaginatedSchema'
